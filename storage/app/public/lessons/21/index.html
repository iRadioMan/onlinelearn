<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тема 21</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="text">
		<h1><strong>Демонстрация работы с&nbsp;таблицами Excel в&nbsp;WPF</strong></h1>

		<p>На&nbsp;данном занятии будет реализована возможность экспорта данных из&nbsp;приложения для визуализации расходов пользователей в&nbsp;таблицу Excel. Расходы каждого пользователя будут экспортироваться в&nbsp;отдельный лист, названием которого будет ФИО пользователя. Расходы будут распределены по&nbsp;категориям, причем по&nbsp;каждой категории будут указываться общие затраты. Основные шаги построения приложения:</p>

		<ol>
			<li>Предварительные шаги</li>
			<li>Реализация экспорта</li>
			<li>Проверка корректной работы приложения</li>
		</ol>

		<h1><strong>Предварительные шаги</strong></h1>

		<p><strong>1.</strong>&nbsp;Подключаем библиотеку для работы с&nbsp;Excel</p>

		<p><img alt="" src="img/1.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Для экспорта данных в&nbsp;Excel используется библиотека Interop. Excel (Object library), расположенная во&nbsp;вкладке COM</p>

		<p><strong>2.</strong>&nbsp;Добавляем кнопку экспорта</p>

		<p><img alt="" src="img/2.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Экспорт данных в&nbsp;Excel будет осуществляться с&nbsp;помощью кнопки &laquo;Экспорт в&nbsp;Excel&raquo;</p>

		<p><strong>3.</strong>&nbsp;Подключаем пространство имен для&nbsp;работы с&nbsp;Excel</p>

		<p><img alt="" src="img/3.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Требуемое пространство имен подключается с&nbsp;помощью директивы using</p>

		<h1><strong>Реализация экспорта</strong></h1>

		<p><strong>1.</strong>&nbsp;Получаем список пользователей</p>

		<p><img alt="" src="img/4.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Список пользователей выгружается из&nbsp;базы данных, причем сразу производится сортировка по&nbsp;ФИО</p>

		<p><strong>2.</strong>&nbsp;Создаем новую книгу Excel</p>

		<p><img alt="" src="img/5.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Объявляем переменную с&nbsp;приложением Excel, указывая количество листов (sheets) равным количеству пользователей в&nbsp;БД. Также добавляем рабочую книгу (workbook)</p>

		<p><strong>3.</strong>&nbsp;Называем листы</p>

		<p><img alt="" src="img/6.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>В&nbsp;цикле по&nbsp;списку пользователей выбирается текущий лист. Текущему листу присваивается ФИО текущего пользователя. Следует обратить внимание, что строки в&nbsp;Excel начинаются с&nbsp;1, потому счетчик строк startRowIndex=1</p>

		<p><strong>4.</strong>&nbsp;Добавляем название колонок</p>

		<p><img alt="" src="img/7.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Название столбцов добавляется в&nbsp;верхнюю строчку листа, после чего увеличивается значение счетчика startRowIndex. Следует обратить внимание, что при обращении к&nbsp;ячейке сначала указывается номер ее&nbsp;столбца, а&nbsp;затем&nbsp;&mdash; номер строки</p>

		<p><strong>5.</strong>&nbsp;Сгруппируем платежи по&nbsp;категориям</p>

		<p><img alt="" src="img/8.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Платежи текущего пользователя группируются с&nbsp;помощью GroupBy и&nbsp;сортируются по&nbsp;дате и&nbsp;названию категории</p>

		<p><strong>6.</strong>&nbsp;Настраиваем отображение названий категорий</p>

		<p><img alt="" src="img/9.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Название каждой категории помещается в&nbsp;объединенную ячейку, выравнивается по&nbsp;центру и&nbsp;отображается курсивом. Далее идет переход к&nbsp;следующей строке</p>

		<p><strong>7.</strong>&nbsp;Добавляем информацию о&nbsp;платежах</p>

		<p><img alt="" src="img/10.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>В&nbsp;цикле по&nbsp;платежам для каждой категории заносим в&nbsp;ячейки таблицы текущей строки дату платежа (в&nbsp;заданном формате), наименование платежа, цену и&nbsp;количество платежей данного типа</p>

		<p><strong>8.</strong>&nbsp;Рассчитываем величину платежа каждой категории</p>

		<p><img alt="" src="img/11.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Чтобы Excel автоматически пересчитывал сумму платежа при изменении количества или цены платежа, следует рассчитывать сумму не&nbsp;в&nbsp;коде, а&nbsp;прямо в&nbsp;ячейке Excel, добавляя туда формулу для расчета. Также для денежных значений можно установить числовой формат</p>

		<p><strong>9.</strong>&nbsp;Добавляем название к&nbsp;ячейкам для хранения общих затрат</p>

		<p><img alt="" src="img/12.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Название ячейки Итого помещается в&nbsp;объединенную ячейку (1&minus;4&nbsp;столбец)</p>

		<p><strong>10.</strong>&nbsp;Рассчитываем величину общих затрат</p>

		<p><img alt="" src="img/13.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Для расчета начального значения диапазона ячеек, учитываемого при расчете, из&nbsp;номера текущей строки вычитается общее количество платежей в&nbsp;рамках категории. Далее величина итоговой суммы выделяется жирным шрифтом и&nbsp;к&nbsp;ней применяется денежный формат</p>

		<p><strong>11.</strong>&nbsp;Завершаем оформление таблицы и&nbsp;реализацию приложения</p>

		<p><img alt="" src="img/14.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Оформление включает в&nbsp;себя: добавление границ (внешних и&nbsp;внутренних), установку автоширины всех столбцов листа. Последняя строчка разрешает отобразить таблицу по&nbsp;завершении экспорта</p>

		<h1><strong>Проверка корректной работы приложения</strong></h1>

		<p><strong>1.</strong>&nbsp;Делаем экспорт данных</p>

		<p><img alt="" src="img/15.jpg" /></p>

		<p><strong>Важно</strong></p>

		<p>Экспорт данных производится по&nbsp;нажатию на&nbsp;кнопку &laquo;Экспорт в&nbsp;Excel&raquo;</p>

		<p><strong>2.</strong>&nbsp;Проводим анализ корректности работы</p>

		<p><img alt="" src="img/16.jpg" /></p>

		<h1>Итоги</h1>

		<p>Вы&nbsp;познакомились с&nbsp;основными программными методами работы с&nbsp;таблицами Excel в&nbsp;WPF.</p>

    </div>
</body>
</html>